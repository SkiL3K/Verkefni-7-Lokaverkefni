# Lesa notendur úr CSV-skjali
$notendur = Import-Csv -Path "notendur.csv"

# Búa til notendahópa
$hoper = "Innkaup", "Sala", "Yfirstjórn", "Allir"

foreach ($hopur in $hoper) {
    New-LocalGroup -Name $hopur
}

# Fara í gegnum hvern notanda og búa til aðgangsorð
foreach ($notandi in $notendur) {
    # Búa til notanda
    $notandiGogn = @{
        "Name"             = $notandi.notendanafn
        "GivenName"        = $notandi.fornafn
        "Surname"          = $notandi.eftirnafn
        "SamAccountName"   = $notandi.notendanafn
        "UserPrincipalName" = "$($notandi.notendanafn)@example.com" # Breyta léninu eftir þörfum
        "Enabled"          = $true
    }
    $nyrNotandi = New-LocalUser @notandiGogn

    # Setja aðgangsorð á notanda
    $lykilord = ConvertTo-SecureString -String "OryggiLykilord123!" -AsPlainText -Force
    $nyrNotandi | Set-LocalUser -Password $lykilord

    # Bæta notanda í sinn hóp
    Add-LocalGroupMember -Group $notandi.hopur -Member $notandi.notendanafn
}

# Bæta öllum notendum í "Allir" hópinn
$allirNotendur = $notendur.notendanafn
Add-LocalGroupMember -Group "Allir" -Member $allirNotendur

# Sýna upplýsingar
$notendur
