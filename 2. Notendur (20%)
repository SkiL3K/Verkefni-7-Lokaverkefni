Búið til notendahópana (e. user group) Innkaup, Sala, Yfirstjórn og Allir. Allir starfsmenn eiga að vera í einum deildarhóp og síðan í Allir hópnum. -

# Stígur að CSV skránni
$csvPath = $csvPath = "C:\Users\Kocham Cycuszki\Desktop\New folder\users\user_data.csv"

# Lesa gögn úr CSV skrá
$userData = Import-Csv -Path $csvPath

# Búa til hópa ef þeir eru ekki til
$groups = "Innkaup", "Sala", "Yfirstjórn", "Allir"

foreach ($group in $groups) {
    if (-not (Get-LocalGroup -Name $group -ErrorAction SilentlyContinue)) {
        New-LocalGroup -Name $group
    }
}

# Loopa í gegnum gögnin og búa til notendur
foreach ($user in $userData) {
    $username = $user.Username
    $password = ConvertTo-SecureString -String $user.Password -AsPlainText -Force
    $userFullName = $user.FullName

    # Búa til notanda
    New-LocalUser -Name $username -Password $password -FullName $userFullName -Description "New user account" -PasswordNeverExpires $true

    # Setja notanda í hópa
    Add-LocalGroupMember -Group "Innkaup" -Member $username
    Add-LocalGroupMember -Group "Sala" -Member $username
    Add-LocalGroupMember -Group "Yfirstjórn" -Member $username
    Add-LocalGroupMember -Group "Allir" -Member $username
}

# Stilla réttindi til að leyfa notendum að skrá sig inn
$groupAll = "Allir"
$allUsers = Get-LocalUser

foreach ($user in $allUsers) {
    Add-LocalGroupMember -Group $groupAll -Member $user.Name
}

